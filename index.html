<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backony's Dream Journal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Poppins:wght@400;500;600;700&display=swap');
        
        :root {
            --primary: #7e22ce;
            --primary-dark: #6b21a8;
            --secondary: #0ea5e9;
            --dark: #1e293b;
            --light: #f8fafc;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            min-height: 100vh;
            transition: background 0.3s ease;
        }
        
        body.dark-mode {
            background: linear-gradient(135deg, #0f172a, #1e293b);
            color: #e2e8f0;
        }
        
        .dream-card {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .dream-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .dream-card:hover::before {
            opacity: 1;
        }
        
        .tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-right: 6px;
            margin-bottom: 4px;
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c7d2fe;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a5b4fc;
        }
        
        .dark-mode ::-webkit-scrollbar-track {
            background: #334155;
        }
        
        .dark-mode ::-webkit-scrollbar-thumb {
            background: #7e22ce;
        }
        
        .dark-mode ::-webkit-scrollbar-thumb:hover {
            background: #6b21a8;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* Modal animations */
        .modal-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        
        .modal-content {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }
        
        .modal-open .modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        
        .modal-closed .modal-content {
            transform: translateY(-20px);
            opacity: 0;
        }
        
        /* Dream card animation on add/delete */
        .dream-card-enter {
            opacity: 0;
            transform: translateY(20px);
        }
        
        .dream-card-enter-active {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        
        .dream-card-exit {
            opacity: 1;
            transform: translateY(0);
        }
        
        .dream-card-exit-active {
            opacity: 0;
            transform: translateY(-20px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        
        /* Loading spinner */
        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-8 px-4 sm:px-6 lg:px-8">
    <div class="max-w-4xl w-full bg-white shadow-xl rounded-xl p-8 sm:p-10 lg:p-12 space-y-8 dark:bg-slate-800 dark:shadow-slate-900/50">
        <header class="text-center mb-10 relative">
            <div class="absolute top-0 right-0 flex gap-2">
                <button id="darkModeToggle" class="p-2 rounded-full bg-gray-200 dark:bg-slate-700 text-gray-700 dark:text-slate-200 hover:bg-gray-300 dark:hover:bg-slate-600 transition-colors">
                    <i class="fas fa-moon dark:hidden"></i>
                    <i class="fas fa-sun hidden dark:block"></i>
                </button>
                <button id="logoutBtn" class="p-2 rounded-full bg-red-100 text-red-700 hover:bg-red-200 transition-colors hidden">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
            
            <h1 class="text-5xl font-extrabold text-gray-900 dark:text-slate-100 leading-tight tracking-tight mb-4">
                <i class="fas fa-moon text-purple-600 dark:text-purple-400 mr-2"></i>
                Backony's Dream Journal
            </h1>
            <p class="text-lg text-gray-600 dark:text-slate-400">
                Documenting the oddities of my subconscious mind
            </p>
        </header>

        <div class="flex flex-col sm:flex-row justify-center items-center gap-4 mb-8 flex-wrap">
            <button id="addDreamBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-75 btn-disabled flex items-center gap-2" aria-label="Add a new dream entry" disabled>
                <i class="fas fa-plus"></i> Add New Dream
            </button>
            <button id="sortDreamsBtn" class="bg-gray-200 dark:bg-slate-700 hover:bg-gray-300 dark:hover:bg-slate-600 text-gray-800 dark:text-slate-200 font-bold py-3 px-6 rounded-lg shadow-md transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-75 flex items-center gap-2">
                <i class="fas fa-sort-amount-down"></i> Sort by Date: Most Current
            </button>
            <button id="exportDreamsBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-75 flex items-center gap-2" aria-label="Export all dreams">
                <i class="fas fa-file-export"></i> Export Dreams
            </button>
            <button id="clearDreamsBtn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-75 flex items-center gap-2 hidden" aria-label="Clear all dreams">
                <i class="fas fa-trash"></i> Clear All
            </button>
        </div>

        <div class="mb-8">
            <div class="relative">
                <input type="text" id="searchDreamsInput" placeholder="Search dreams by title, content or tags..." class="w-full pl-12 pr-4 py-3 border border-gray-300 dark:border-slate-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg bg-white dark:bg-slate-700 dark:text-slate-200">
                <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 dark:text-slate-400">
                    <i class="fas fa-search"></i>
                </div>
            </div>
            
            <div class="mt-4 flex flex-wrap gap-2" id="tagFilters">
                <span class="text-gray-600 dark:text-slate-400 font-medium mr-2">Filter by tag:</span>
                <!-- Tags will be dynamically added here -->
            </div>
        </div>

        <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-bold text-gray-800 dark:text-slate-200">Dream Entries</h2>
            <div class="text-sm text-gray-600 dark:text-slate-400">
                <span id="dreamCount">0</span> dreams recorded
            </div>
        </div>

        <main id="dreamEntries" class="space-y-6">
            <!-- Dream entries will be dynamically added here -->
            <div class="text-center py-12 text-gray-500 dark:text-slate-400" id="emptyState">
                <i class="fas fa-cloud text-5xl mb-4"></i>
                <h3 class="text-xl font-medium">No dreams recorded yet</h3>
                <p class="mt-2">Start by adding your first dream entry!</p>
            </div>
        </main>
    </div>

    <!-- Password Modal -->
    <div id="passwordModal" class="modal-overlay fixed inset-0 flex items-center justify-center p-4 hidden opacity-0" role="dialog" aria-modal="true" aria-labelledby="passwordModalTitle">
        <div class="modal-content bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-sm relative">
            <h3 id="passwordModalTitle" class="text-2xl font-bold text-gray-800 dark:text-slate-100 mb-6 text-center">Enter Password</h3>
            <form id="passwordForm" class="space-y-4">
                <div>
                    <label for="passwordInput" class="sr-only">Password</label>
                    <div class="relative">
                        <input type="password" id="passwordInput" name="passwordInput" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-slate-700 dark:text-slate-200" placeholder="Password" required>
                        <button type="button" id="togglePassword" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-slate-400">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <p id="passwordMessage" class="text-center text-sm text-red-600 hidden">Incorrect password. Please try again.</p>
                <button type="submit" id="passwordSubmitBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md shadow-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 flex justify-center items-center gap-2">
                    <span>Submit</span>
                    <div id="passwordSpinner" class="spinner hidden"></div>
                </button>
            </form>
        </div>
    </div>

    <!-- Dream Form Modal -->
    <div id="dreamFormModal" class="modal-overlay fixed inset-0 flex items-center justify-center p-4 hidden opacity-0" role="dialog" aria-modal="true" aria-labelledby="dreamFormModalTitle">
        <div class="modal-content bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-md relative">
            <button id="closeDreamFormModalBtn" class="absolute top-3 right-3 text-gray-500 dark:text-slate-400 hover:text-gray-700 dark:hover:text-slate-300 text-2xl font-bold" aria-label="Close dialog">&times;</button>
            <h3 id="dreamFormModalTitle" class="text-2xl font-bold text-gray-800 dark:text-slate-100 mb-6 text-center">Add New Dream</h3>
            <form id="dreamForm" class="space-y-4">
                <input type="hidden" id="dreamId" name="dreamId">
                <div>
                    <label for="dreamTitle" class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1">Dream Title</label>
                    <input type="text" id="dreamTitle" name="dreamTitle" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-slate-700 dark:text-slate-200" placeholder="e.g., Flying through clouds" required>
                </div>
                <div>
                    <label for="dreamDate" class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1">Date (DD/MM/YYYY)</label>
                    <input type="text" id="dreamDate" name="dreamDate" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-slate-700 dark:text-slate-200" placeholder="e.g., 25/12/2024" pattern="\d{2}/\d{2}/\d{4}" title="Please use DD/MM/YYYY format" required>
                </div>
                <div>
                    <label for="dreamTags" class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1">Tags (comma separated)</label>
                    <input type="text" id="dreamTags" name="dreamTags" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-slate-700 dark:text-slate-200" placeholder="e.g., adventure, flying, surreal">
                    <p class="mt-1 text-xs text-gray-500 dark:text-slate-400">Enter tags separated by commas</p>
                </div>
                <div>
                    <label for="dreamContent" class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1">Dream Content</label>
                    <textarea id="dreamContent" name="dreamContent" rows="6" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-slate-700 dark:text-slate-200" placeholder="Describe your dream here..." required></textarea>
                </div>
                <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md shadow-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                    Save Dream
                </button>
            </form>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="modal-overlay fixed inset-0 flex items-center justify-center p-4 hidden opacity-0" role="dialog" aria-modal="true" aria-labelledby="confirmationModalTitle">
        <div class="modal-content bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-sm relative text-center">
            <h3 id="confirmationModalTitle" class="text-xl font-bold text-gray-800 dark:text-slate-100 mb-4">Confirm Deletion</h3>
            <p class="text-gray-700 dark:text-slate-300 mb-6">Are you sure you want to delete this dream entry?</p>
            <div class="flex justify-center gap-4">
                <button id="confirmDeleteBtn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md shadow-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2">
                    Delete
                </button>
                <button id="cancelDeleteBtn" class="bg-gray-300 hover:bg-gray-400 dark:bg-slate-600 dark:hover:bg-slate-500 text-gray-800 dark:text-slate-200 font-bold py-2 px-4 rounded-md shadow-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- Constants and Initial Data ---
        const CORRECT_PASSWORD = 'DreamJournal2025!';
        const DREAM_CARD_COLORS = [
            'bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-800',
            'bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800',
            'bg-purple-50 border-purple-200 dark:bg-purple-900/20 dark:border-purple-800',
            'bg-yellow-50 border-yellow-200 dark:bg-yellow-900/20 dark:border-yellow-800',
            'bg-pink-50 border-pink-200 dark:bg-pink-900/20 dark:border-pink-800',
            'bg-indigo-50 border-indigo-200 dark:bg-indigo-900/20 dark:border-indigo-800',
            'bg-cyan-50 border-cyan-200 dark:bg-cyan-900/20 dark:border-cyan-800'
        ];

        const TAG_COLORS = [
            'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200',
            'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200',
            'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200',
            'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200',
            'bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-200',
            'bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200',
            'bg-cyan-100 text-cyan-800 dark:bg-cyan-900 dark:text-cyan-200',
            'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200',
            'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200',
            'bg-teal-100 text-teal-800 dark:bg-teal-900 dark:text-teal-200'
        ];

        // Initial dream data
        let dreams = [
            { id: 'd1', title: 'Drink after a battle', date: '05/02/2025', content: `This dream was a little weird. I was on a team with red guys (who seemed to be those guys from the game TABS), and there were some of us (I'd say 25 - 50). The opposing team was, of course, blue. This seems a lot like a match on TABS (If you played the game, you'd know what I mean), Both teams were equipped with muskets and had 1800s European army attire. I don't quite remember where we fought, but I think we fought on the "simulation" map or whatever it's called. The map is just a big flat white plane.\n\nI don't remember the confrontation (or if there was even one at all), but I do remember what happened after it. I then teleported in my kitchen, with a couple of red guys from my team. We were all drinking Corona (The beer with 20% alcohol), they were then telling me to take the "Golden Eraser". A yellow eraser with a fancy 'G' printed on it. It was at a cabinet near me, I took it out from it and putted it in my mouth. Then I woke up.\n\nThat's the most I remember from that dream!`, tags: ['battle', 'strange', 'gaming'] },
            { id: 'd2', title: 'Fighting a kid on the school yard', date: '01/05/2025', content: `It’s been a while since I last documented a dream, and this one was quite violent.\n\nI can't recall the exact starting place or earlier events, but I remember being with some random guys who were supposed to be my "friends." We were playing in a schoolyard that looked somewhat different, and it was slightly foggy. Suddenly, a redhead kid with round glasses, freckles, and possibly a buck tooth approached us. He looked like the stereotypical nerd, but a redhead. He seemed to be about 8 years old, maybe in 3rd or 4th grade. For no apparent reason, he decided to attack us, and I was the only one who actually fought back!\n\nWe ended up fighting, though I can't remember much of the actual confrontation. I do recall that I was incredibly fast, while he hit and ran like a typical 8-year-old. As a result, I defeated him in the fight.\n\nThat’s about all I remember from the dream, it was super weird. I also remember the schoolyard having one of those small circular area filled with dirt and red rock, with a long fence running around a quarter of its perimeter (I don't know what they're called).`, tags: ['school', 'fight', 'violence'] },
            { id: 'd3', title: 'Weird school thing', date: '13/05/2025', content: `It's another dream about school, I remember it being recess, and I was playing so it could've possibly taken place while I was in 5-6th grade, during the morning. It was at the field of the school, and there was a giant foam that was around 10 times taller than our school that could've been possibly gum, but it was very foamy yet dense. the color itself was purple and blue, the colors were of course blended with patches of just those colors. I ate the foam and tasted like bubblegum. I liked it and I ate a lot, and others were too. I remember looking away then looking back, the foam was gone. It seemed like everyone ate it. Anyways, I went to play on the field, with... whatever game I played, and I went inside the school where I think my dream ended.`, tags: ['school', 'food', 'strange'] },
            { id: 'd4', title: 'Cooking some Pancakes', date: '14/05/2025', content: `First, I need to say that on April 8th, I was cooking some pancakes (Which had too much flour), so this may had caused this dream.\n\nAnyways, this time, it wasn't a dream about school, it was a dream that took place at my house. I couldn't remember much, but I do remember me and probably my mom cooking pancakes or crepes with me at morning or noon. The only thing I remember doing in that dream was pouring evaporated milk (the exact brand I had in my house), onto the batter, and the batter was in a pan. Alright so, WHY THE HELL IS THERE BATTER ON A PAN! You're supposed to mix it in a separate container! Whatever, this was just a dream. Well, that's all :D`, tags: ['cooking', 'family', 'food'] },
            { id: 'd5', title: 'Eating human meat', date: '15/05/2025', content: `Now, this has to be in my list of my REALLY weird dreams (definitely top 20).\n\nI remember eating some raw human meat and I was critiquing its taste and its texture. I vividly remember walking around the house and my auntie in the kitchen who had a BIG portion of human meat on the kitchen table that seemed to be the back of a human, but there were some rib bones (a little larger than usual), I'm not too sure since I haven't went to the kitchen myself. The meat's texture was similar to that of a fish, but it felt like it had its own texture... the taste? I don't remember, but it could've been like a combination of some fish and pork or something else similar. It seemed to be noon since I saw the outside, and that's it.`, tags: ['weird', 'food', 'horror'] },
            { id: 'd6', title: 'Selling stuff', date: '18/05/2025', content: `Alright, so I wanna say that I've been playing the ROBLOX game "Grow a Garden" for a while now, so this may be the cause.\n\nSo, I was in this place, it seemed to be evening. It was a giant farmer's market, and I was the owner of this stand that had a red and white horizontally striped awning, with brown wood structure. It was super chill, I've managed to get one or two customers, but I knew this guy that was wearing a red shirt that reminded me that I should "call my fruits for 200 dollars so they sell for more". I got no damn idea why "calling" your fruits is even possible but it worked.\n\nEach of our stands were lit with some LED light strip, or some unknown source, mine lit sky blue. We were placed in order, and were around 5 meters apart on the sidewalk (we were placed on both of the sidewalks), and 8 meters apart. At the other side, there was this ordinary park, but in the evening light, it looked sort of nice to go in. And for some reason, there was a huge corporate building behind us, the generic kind you would find in cartoons.\n\nThere were some people walking the other side of the sidewalk, walking like NPCs (No like, actually). I don't remember much of the events of the dream, but it was relaxing for the most part.`, tags: ['business', 'gaming', 'relaxing'] },
            { id: 'd7', title: 'Weird school thing', date: '21/05/2025', content: `It was a dream about school, but I forgot a bunch of the events. The only thing I remember from that dream is thar I approached Brandon and he had an entire pack of Bavarian sausages. I asked him if I could have one but he responded to me with "no".`, tags: ['school', 'food', 'disappointment'] },
            { id: 'd8', title: 'idk what to even say', date: '22/05/2025', content: `These are one of the few vivid dreams that I actually remember. So, I was in this house in this random neighborhood. So, I was in this house with around 30 7-12 year old girls with one woman, probably in her mid-20s being in charge, and I was somehow in this house with them. They were basically running a campaign where they were cooking hamburgers(?) for some orphanage, to do it, they had a huge machine in the house's kitchen (a part the roof literally had to be extended) that was used to make these burgers. It had conveyor belts, one electronic-sign, and it was a cool machine. I was just looking around the living room, I look at the machine, then I looked back, with everyone gone! I remember that they left, but they just disappeared out of thin air. The only person left was this 7 year old operating the machine.\n\nI had for some reason a bottle that seemed like those Magi bottles but it was larger and had some strange labeling, I poured some of the liquid inside the bottle on one of the conveyor belts, and the girl in the kitchen gasped and called the police, I don't know what have I done wrong but that happened. A weird thing I found about it was that the liquid stayed on the conveyor belt and it was vaporizing. Anyways, while she was calling the police, I had this countdown on my wrist, it was a white-colored and black outlined 2D text that was counting down in seconds, I thought it was the time until the police arrives, but it was going back to 36 - 37 after some time, so I forgot about it. I looked outside the window briefly, and the neighborhood looked like your average suburban neighborhood. There was a stone wall with the word "Science" in bronze, which I assume is the neighborhood's name.\n\nSo, I ran into the closet of the bedroom, and for some reason, I've been able to look outside of the closet since it was really transparent (not completely) from the inside. I sat down, legs close to torso and arms covering them. Then, it gets slightly more weirder. There was a bar in my view (it looked like I was viewing through a screen), an orange one. It had a circle that was near the end of the bar. I put the circle in the very end, and there was a Game Over music theme playing, the ones from the 2000s (I forgot which one it sounded like). I was probably found and died from the girls or the police. After that, the dream ended and I woke up. Geez, that was something.`, tags: ['weird', 'mystery', 'technology'] }
        ];

        // --- DOM Element References ---
        const addDreamBtn = document.getElementById('addDreamBtn');
        const sortDreamsBtn = document.getElementById('sortDreamsBtn');
        const exportDreamsBtn = document.getElementById('exportDreamsBtn');
        const clearDreamsBtn = document.getElementById('clearDreamsBtn');
        const searchDreamsInput = document.getElementById('searchDreamsInput');
        const dreamEntriesContainer = document.getElementById('dreamEntries');
        const dreamCount = document.getElementById('dreamCount');
        const emptyState = document.getElementById('emptyState');
        const logoutBtn = document.getElementById('logoutBtn');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const tagFiltersContainer = document.getElementById('tagFilters');

        // Modals
        const passwordModal = document.getElementById('passwordModal');
        const passwordForm = document.getElementById('passwordForm');
        const passwordInput = document.getElementById('passwordInput');
        const passwordMessage = document.getElementById('passwordMessage');
        const togglePassword = document.getElementById('togglePassword');
        const passwordSubmitBtn = document.getElementById('passwordSubmitBtn');
        const passwordSpinner = document.getElementById('passwordSpinner');

        const dreamFormModal = document.getElementById('dreamFormModal');
        const closeDreamFormModalBtn = document.getElementById('closeDreamFormModalBtn');
        const dreamForm = document.getElementById('dreamForm');
        const dreamFormModalTitle = document.getElementById('dreamFormModalTitle');
        const dreamIdInput = document.getElementById('dreamId');
        const dreamTitleInput = document.getElementById('dreamTitle');
        const dreamDateInput = document.getElementById('dreamDate');
        const dreamTagsInput = document.getElementById('dreamTags');
        const dreamContentInput = document.getElementById('dreamContent');

        const confirmationModal = document.getElementById('confirmationModal');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');

        // --- State Variables ---
        let isAuthenticated = localStorage.getItem('isAuthenticated') === 'true';
        let sortOrder = 'desc';
        let dreamToDeleteId = null;
        let activeTagFilter = null;
        let darkMode = localStorage.getItem('darkMode') === 'true';

        // --- Helper Functions ---

        /**
         * Opens a modal with a fade-in and slide-down effect.
         * @param {HTMLElement} modalElement - The modal element to open.
         */
        function openModal(modalElement) {
            modalElement.classList.remove('hidden', 'modal-closed');
            modalElement.classList.add('flex', 'modal-open');
            void modalElement.offsetWidth;
            modalElement.style.opacity = '1';
        }

        /**
         * Closes a modal with a fade-out and slide-up effect.
         * @param {HTMLElement} modalElement - The modal element to close.
         */
        function closeModal(modalElement) {
            modalElement.style.opacity = '0';
            modalElement.classList.remove('modal-open');
            modalElement.classList.add('modal-closed');
            setTimeout(() => {
                modalElement.classList.remove('flex');
                modalElement.classList.add('hidden');
            }, 300);
        }

        /**
         * Parses a DD/MM/YYYY date string into a Date object.
         * @param {string} dateString - The date string in DD/MM/YYYY format.
         * @returns {Date} A Date object.
         */
        function parseDate(dateString) {
            const parts = dateString.split('/');
            return new Date(parts[2], parts[1] - 1, parts[0]);
        }

        /**
         * Formats a Date object into a DD/MM/YYYY string.
         * @param {Date} date - The Date object.
         * @returns {string} The formatted date string.
         */
        function formatDate(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        /**
         * Generates a unique ID for new dreams.
         * @returns {string} A unique ID.
         */
        function generateUniqueId() {
            return 'd' + Date.now().toString(36) + Math.random().toString(36).substring(2, 5);
        }

        /**
         * Updates the UI based on authentication status.
         */
        function updateUIForAuth() {
            if (isAuthenticated) {
                addDreamBtn.classList.remove('btn-disabled');
                addDreamBtn.disabled = false;
                clearDreamsBtn.classList.remove('hidden');
                logoutBtn.classList.remove('hidden');
            } else {
                addDreamBtn.classList.add('btn-disabled');
                addDreamBtn.disabled = true;
                clearDreamsBtn.classList.add('hidden');
                logoutBtn.classList.add('hidden');
            }
        }

        /**
         * Toggles password visibility
         */
        function togglePasswordVisibility() {
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                togglePassword.innerHTML = '<i class="fas fa-eye-slash"></i>';
            } else {
                passwordInput.type = 'password';
                togglePassword.innerHTML = '<i class="fas fa-eye"></i>';
            }
        }

        /**
         * Gets all unique tags from dreams
         */
        function getAllTags() {
            const tags = new Set();
            dreams.forEach(dream => {
                if (dream.tags && dream.tags.length) {
                    dream.tags.forEach(tag => tags.add(tag.toLowerCase()));
                }
            });
            return Array.from(tags);
        }

        /**
         * Renders tag filters
         */
        function renderTagFilters() {
            const tags = getAllTags();
            tagFiltersContainer.innerHTML = '<span class="text-gray-600 dark:text-slate-400 font-medium mr-2">Filter by tag:</span>';
            
            // Add "All" tag filter
            const allTagBtn = document.createElement('button');
            allTagBtn.classList.add('tag', 'cursor-pointer', activeTagFilter === null ? 'bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200' : 'bg-gray-100 text-gray-800 dark:bg-slate-700 dark:text-slate-300');
            allTagBtn.textContent = 'All';
            allTagBtn.addEventListener('click', () => {
                activeTagFilter = null;
                renderDreams();
                renderTagFilters();
            });
            tagFiltersContainer.appendChild(allTagBtn);
            
            // Add each tag as a filter
            tags.forEach(tag => {
                const tagBtn = document.createElement('button');
                tagBtn.classList.add('tag', 'cursor-pointer', activeTagFilter === tag ? TAG_COLORS[Math.floor(Math.random() * TAG_COLORS.length)] : 'bg-gray-100 text-gray-800 dark:bg-slate-700 dark:text-slate-300');
                tagBtn.textContent = tag;
                tagBtn.addEventListener('click', () => {
                    activeTagFilter = tag;
                    renderDreams();
                    renderTagFilters();
                });
                tagFiltersContainer.appendChild(tagBtn);
            });
        }

        /**
         * Renders all dreams to the DOM based on the current 'dreams' array.
         * Applies search and tag filters.
         */
        function renderDreams() {
            dreamEntriesContainer.innerHTML = '';
            const searchQuery = searchDreamsInput.value.toLowerCase();

            // Sort dreams based on current sortOrder
            const sortedDreams = [...dreams].sort((a, b) => {
                const dateA = parseDate(a.date);
                const dateB = parseDate(b.date);
                return sortOrder === 'asc' ? dateA - dateB : dateB - dateA;
            });

            let visibleCount = 0;
            
            sortedDreams.forEach((dream, index) => {
                const titleLower = dream.title.toLowerCase();
                const contentLower = dream.content.toLowerCase();
                const tagsLower = dream.tags ? dream.tags.join(' ').toLowerCase() : '';

                // Apply search filter
                if (searchQuery && !titleLower.includes(searchQuery) && 
                    !contentLower.includes(searchQuery) && 
                    !tagsLower.includes(searchQuery)) {
                    return;
                }
                
                // Apply tag filter
                if (activeTagFilter && (!dream.tags || !dream.tags.map(t => t.toLowerCase()).includes(activeTagFilter))) {
                    return;
                }
                
                visibleCount++;
                
                const dreamCard = document.createElement('div');
                const colorClass = DREAM_CARD_COLORS[index % DREAM_CARD_COLORS.length];
                
                dreamCard.classList.add(
                    'dream-card', 'p-6', 'rounded-lg', 'shadow-md', 'border', 
                    'hover:shadow-lg', 'transition-shadow', 'duration-300', 'dream-card-enter',
                    'fade-in', colorClass
                );
                dreamCard.setAttribute('data-id', dream.id);
                dreamCard.setAttribute('data-date', `${parseDate(dream.date).getFullYear()}-${String(parseDate(dream.date).getMonth() + 1).padStart(2, '0')}-${String(parseDate(dream.date).getDate()).padStart(2, '0')}`);

                // Build tags HTML
                let tagsHtml = '';
                if (dream.tags && dream.tags.length) {
                    tagsHtml = '<div class="mt-4 flex flex-wrap gap-2">';
                    dream.tags.forEach(tag => {
                        const tagColor = TAG_COLORS[Math.floor(Math.random() * TAG_COLORS.length)];
                        tagsHtml += `<span class="tag ${tagColor}">${tag}</span>`;
                    });
                    tagsHtml += '</div>';
                }

                dreamCard.innerHTML = `
                    <div class="flex justify-between items-start">
                        <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 dark:text-slate-100 mb-2">${dream.title}</h2>
                        <span class="text-sm text-gray-600 dark:text-slate-400 font-medium">${dream.date}</span>
                    </div>
                    <p class="text-gray-700 dark:text-slate-300 leading-relaxed whitespace-pre-wrap mb-4">${dream.content}</p>
                    ${tagsHtml}
                `;

                // Add edit/delete buttons if authenticated
                if (isAuthenticated) {
                    const actionsDiv = document.createElement('div');
                    actionsDiv.classList.add('dream-actions', 'flex', 'gap-2', 'mt-4');
                    actionsDiv.innerHTML = `
                        <button class="edit-dream-btn bg-blue-500 hover:bg-blue-600 text-white text-sm font-bold py-1 px-3 rounded-md transition-colors duration-200" aria-label="Edit dream">
                            <i class="fas fa-edit mr-1"></i> Edit
                        </button>
                        <button class="delete-dream-btn bg-red-500 hover:bg-red-600 text-white text-sm font-bold py-1 px-3 rounded-md transition-colors duration-200" aria-label="Delete dream">
                            <i class="fas fa-trash mr-1"></i> Delete
                        </button>
                    `;
                    dreamCard.appendChild(actionsDiv);
                }

                dreamEntriesContainer.appendChild(dreamCard);

                // Trigger animation
                setTimeout(() => {
                    dreamCard.classList.add('dream-card-enter-active');
                }, 10);
            });
            
            // Update dream count
            dreamCount.textContent = visibleCount;
            
            // Show empty state if no dreams
            if (visibleCount === 0) {
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
            }

            // Re-attach event listeners for edit/delete buttons
            attachDreamCardListeners();
        }

        /**
         * Attaches event listeners to dynamically created edit and delete buttons.
         */
        function attachDreamCardListeners() {
            document.querySelectorAll('.edit-dream-btn').forEach(button => {
                button.onclick = (event) => {
                    const dreamCard = event.target.closest('.dream-card');
                    const dreamId = dreamCard.getAttribute('data-id');
                    editDream(dreamId);
                };
            });

            document.querySelectorAll('.delete-dream-btn').forEach(button => {
                button.onclick = (event) => {
                    const dreamCard = event.target.closest('.dream-card');
                    const dreamId = dreamCard.getAttribute('data-id');
                    showDeleteConfirmation(dreamId);
                };
            });
        }

        // --- Core Functionality ---

        /**
         * Handles password submission.
         * @param {Event} event - The form submission event.
         */
        function handlePasswordSubmit(event) {
            event.preventDefault();
            const enteredPassword = passwordInput.value;
            
            // Show loading spinner
            passwordSubmitBtn.disabled = true;
            passwordSpinner.classList.remove('hidden');
            
            // Simulate server delay for UX
            setTimeout(() => {
                if (enteredPassword === CORRECT_PASSWORD) {
                    isAuthenticated = true;
                    localStorage.setItem('isAuthenticated', 'true');
                    passwordMessage.classList.add('hidden');
                    closeModal(passwordModal);
                    updateUIForAuth();
                    renderDreams();
                } else {
                    passwordMessage.textContent = 'Incorrect password. Please try again.';
                    passwordMessage.classList.remove('hidden');
                    passwordInput.value = '';
                    passwordInput.focus();
                }
                
                // Reset button state
                passwordSubmitBtn.disabled = false;
                passwordSpinner.classList.add('hidden');
            }, 800);
        }

        /**
         * Logs out the user
         */
        function logout() {
            isAuthenticated = false;
            localStorage.removeItem('isAuthenticated');
            updateUIForAuth();
            renderDreams();
            
            // Show logout notification
            showNotification('You have been logged out', 'bg-indigo-600');
        }

        /**
         * Shows a notification
         * @param {string} message - Notification message
         * @param {string} bgClass - Background color class
         */
        function showNotification(message, bgClass) {
            // Remove existing notification
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) existingNotification.remove();
            
            const notification = document.createElement('div');
            notification.classList.add('notification', 'fixed', 'top-4', 'right-4', 'px-6', 'py-3', 'rounded-lg', 'shadow-lg', 'text-white', 'font-medium', 'z-50', 'fade-in', bgClass);
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        /**
         * Opens the add/edit dream modal.
         * @param {object|null} dreamData - Pre-fill data for editing, or null for new dream.
         */
        function openDreamFormModal(dreamData = null) {
            dreamForm.reset();
            passwordMessage.classList.add('hidden');

            if (dreamData) {
                dreamFormModalTitle.textContent = 'Edit Dream';
                dreamIdInput.value = dreamData.id;
                dreamTitleInput.value = dreamData.title;
                dreamDateInput.value = dreamData.date;
                dreamContentInput.value = dreamData.content;
                dreamTagsInput.value = dreamData.tags ? dreamData.tags.join(', ') : '';
            } else {
                dreamFormModalTitle.textContent = 'Add New Dream';
                dreamIdInput.value = '';
                dreamDateInput.value = formatDate(new Date());
            }
            openModal(dreamFormModal);
            dreamTitleInput.focus();
        }

        /**
         * Handles saving a new or edited dream.
         * @param {Event} event - The form submission event.
         */
        function saveDream(event) {
            event.preventDefault();

            const id = dreamIdInput.value;
            const title = dreamTitleInput.value;
            const date = dreamDateInput.value;
            const content = dreamContentInput.value;
            const tags = dreamTagsInput.value.split(',').map(tag => tag.trim()).filter(tag => tag.length > 0);

            // Basic date format validation
            if (!/^\d{2}\/\d{2}\/\d{4}$/.test(date)) {
                alert('Invalid date format. Please use DD/MM/YYYY.');
                return;
            }

            if (id) {
                // Editing existing dream
                const dreamIndex = dreams.findIndex(d => d.id === id);
                if (dreamIndex !== -1) {
                    dreams[dreamIndex] = { id, title, date, content, tags };
                    showNotification('Dream updated successfully', 'bg-blue-600');
                }
            } else {
                // Adding new dream
                const newDream = {
                    id: generateUniqueId(),
                    title,
                    date,
                    content,
                    tags
                };
                dreams.push(newDream);
                showNotification('Dream added successfully', 'bg-green-600');
            }

            closeModal(dreamFormModal);
            renderDreams();
            renderTagFilters();
        }

        /**
         * Initiates the edit process for a specific dream.
         * @param {string} dreamId - The ID of the dream to edit.
         */
        function editDream(dreamId) {
            const dream = dreams.find(d => d.id === dreamId);
            if (dream) {
                openDreamFormModal(dream);
            }
        }

        /**
         * Shows the confirmation modal before deleting a dream.
         * @param {string} dreamId - The ID of the dream to delete.
         */
        function showDeleteConfirmation(dreamId) {
            dreamToDeleteId = dreamId;
            openModal(confirmationModal);
        }

        /**
         * Deletes a dream after confirmation.
         */
        function deleteDream() {
            if (dreamToDeleteId) {
                const dreamCardElement = document.querySelector(`.dream-card[data-id="${dreamToDeleteId}"]`);
                if (dreamCardElement) {
                    dreamCardElement.classList.add('dream-card-exit');
                    dreamCardElement.classList.remove('dream-card-enter-active');

                    setTimeout(() => {
                        dreams = dreams.filter(d => d.id !== dreamToDeleteId);
                        dreamCardElement.remove();
                        dreamToDeleteId = null;
                        closeModal(confirmationModal);
                        renderDreams();
                        renderTagFilters();
                        showNotification('Dream deleted', 'bg-red-600');
                    }, 500);
                }
            }
        }

        /**
         * Clears all dreams after confirmation.
         */
        function clearAllDreams() {
            if (dreams.length === 0) return;
            
            // Update confirmation modal for clearing all
            document.getElementById('confirmationModalTitle').textContent = 'Confirm Clear All';
            document.querySelector('#confirmationModal p').textContent = 'Are you sure you want to delete ALL dream entries? This cannot be undone.';
            dreamToDeleteId = 'all';
            openModal(confirmationModal);
        }

        /**
         * Toggles the sort order of dreams and re-renders them.
         */
        function toggleSortOrder() {
            sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
            sortDreamsBtn.innerHTML = `<i class="fas fa-sort-amount-${sortOrder === 'asc' ? 'up' : 'down'}"></i> Sort by Date: ${sortOrder === 'asc' ? 'Earliest' : 'Most Current'}`;
            renderDreams();
        }

        /**
         * Filters dreams based on search input.
         */
        function filterDreams() {
            renderDreams();
        }

        /**
         * Toggles dark mode
         */
        function toggleDarkMode() {
            darkMode = !darkMode;
            localStorage.setItem('darkMode', darkMode.toString());
            
            if (darkMode) {
                document.body.classList.add('dark-mode');
                darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                document.body.classList.remove('dark-mode');
                darkModeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }
        }

        /**
         * Exports all dreams to a text file.
         */
        function exportDreams() {
            let exportText = "My Dream Journal Entries\n\n";
            exportText += `Exported on: ${new Date().toLocaleDateString()}\n`;
            exportText += "======================================\n\n";
            
            dreams.forEach(dream => {
                exportText += `--- Dream: ${dream.title} ---\n`;
                exportText += `Date: ${dream.date}\n`;
                if (dream.tags && dream.tags.length) {
                    exportText += `Tags: ${dream.tags.join(', ')}\n`;
                }
                exportText += `Content:\n${dream.content}\n\n`;
            });

            const blob = new Blob([exportText], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'my_dream_journal.txt';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
            
            showNotification('Dreams exported successfully', 'bg-green-600');
        }

        // --- Event Listeners ---

        // Password protection
        addDreamBtn.addEventListener('click', () => {
            if (!isAuthenticated) {
                openModal(passwordModal);
                passwordInput.focus();
            } else {
                openDreamFormModal();
            }
        });
        passwordForm.addEventListener('submit', handlePasswordSubmit);
        togglePassword.addEventListener('click', togglePasswordVisibility);

        // Logout
        logoutBtn.addEventListener('click', logout);

        // Dream Form Modal
        closeDreamFormModalBtn.addEventListener('click', () => closeModal(dreamFormModal));
        dreamForm.addEventListener('submit', saveDream);

        // Confirmation Modal
        confirmDeleteBtn.addEventListener('click', () => {
            if (dreamToDeleteId === 'all') {
                dreams = [];
                renderDreams();
                renderTagFilters();
                showNotification('All dreams cleared', 'bg-red-600');
            } else {
                deleteDream();
            }
            closeModal(confirmationModal);
        });
        cancelDeleteBtn.addEventListener('click', () => {
            closeModal(confirmationModal);
            dreamToDeleteId = null;
        });

        // Other main buttons
        sortDreamsBtn.addEventListener('click', toggleSortOrder);
        exportDreamsBtn.addEventListener('click', exportDreams);
        clearDreamsBtn.addEventListener('click', clearAllDreams);
        searchDreamsInput.addEventListener('input', filterDreams);
        darkModeToggle.addEventListener('click', toggleDarkMode);

        // --- Initial Setup ---
        function init() {
            // Set initial dark mode state
            if (darkMode) {
                document.body.classList.add('dark-mode');
                darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                document.body.classList.remove('dark-mode');
                darkModeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }
            
            // Render initial content
            renderDreams();
            renderTagFilters();
            updateUIForAuth();
        }

        // Initialize the app
        init();
    </script>
</body>
</html>
